# Struktur Project Smart Expense Tracker (SET)

## Overview
Aplikasi web polyglot dengan PHP backend, Python untuk visualisasi, dan MySQL database.

## Struktur File

```
Aplikasi Pencatatan Keuangan & Visualisasi Grafik (Expense Tracker)/
│
├── api/                              # API Endpoints (REST-like)
│   ├── add_transaction.php          # POST: Tambah transaksi baru
│   ├── update_transaction.php       # POST: Update transaksi
│   ├── delete_transaction.php       # POST: Hapus transaksi (dengan trigger)
│   ├── get_transactions.php         # GET: Ambil semua transaksi (JSON)
│   └── get_summary.php              # GET: Ringkasan bulanan (JSON)
│
├── assets/                           # Static Assets
│   └── charts/                      # Folder untuk menyimpan chart PNG
│       └── chart_latest.png         # (Generated by Python script)
│
├── config/                          # Konfigurasi
│   └── database.php                 # Database connection & config
│
├── database/                        # Database Schema
│   └── schema.sql                  # SQL schema dengan:
│                                   # - Tables (tb_transaksi, tb_log_hapus)
│                                   # - View (v_ringkasan_bulanan)
│                                   # - Stored Procedure (sp_tambah_transaksi)
│                                   # - Function (fn_cek_kesehatan_finansial)
│                                   # - Trigger (tr_audit_hapus)
│
├── python/                          # Python Scripts
│   └── generate_chart.py           # Script untuk generate pie chart
│                                   # Menggunakan: matplotlib, pandas, mysql-connector
│
├── index.php                        # Halaman utama (Dashboard)
│                                   # - Menampilkan chart
│                                   # - Menampilkan ringkasan
│                                   # - Daftar transaksi
│                                   # - Form CRUD
│                                   # - Live search
│
├── README.md                        # Dokumentasi utama
├── SETUP.md                         # Panduan instalasi detail
├── requirements.txt                 # Python dependencies
└── .gitignore                       # Git ignore rules
```

## Alur Data

### 1. Tambah Transaksi
```
User Input → index.php → api/add_transaction.php 
→ Stored Procedure (sp_tambah_transaksi) 
→ MySQL (tb_transaksi)
→ Python Script (generate_chart.py)
→ assets/charts/chart_latest.png
→ Refresh Dashboard
```

### 2. Generate Chart
```
index.php (on load) → shell_exec() 
→ python/generate_chart.py
→ MySQL Query (SUM pemasukan & pengeluaran)
→ Matplotlib (generate pie chart)
→ Save PNG to assets/charts/
→ Display in index.php
```

### 3. Hapus Transaksi
```
User Click Delete → api/delete_transaction.php
→ DELETE FROM tb_transaksi
→ Trigger (tr_audit_hapus) fires
→ INSERT INTO tb_log_hapus (backup)
→ Regenerate chart
```

### 4. Live Search
```
User Type → JavaScript (index.php)
→ Filter DOM (table rows)
→ No server request (client-side only)
```

## Database Schema

### Tables
1. **tb_transaksi**
   - id (PK, AUTO_INCREMENT)
   - tanggal (DATE)
   - jenis (VARCHAR: 'Masuk'/'Keluar')
   - kategori (VARCHAR)
   - nominal (DOUBLE)
   - keterangan (TEXT)
   - created_at (TIMESTAMP)

2. **tb_log_hapus**
   - id (PK, AUTO_INCREMENT)
   - id_transaksi_lama (INT)
   - nominal (DOUBLE)
   - waktu_hapus (TIMESTAMP)

### View
- **v_ringkasan_bulanan**: Agregat bulanan (total_masuk, total_keluar, saldo)

### Stored Procedure
- **sp_tambah_transaksi**: Insert dengan auto-fill keterangan jika kosong

### Function
- **fn_cek_kesehatan_finansial**: Return 'BAHAYA/BOROS' atau 'AMAN/HEMAT'

### Trigger
- **tr_audit_hapus**: Backup data sebelum DELETE

## Teknologi Stack

| Layer | Technology | Purpose |
|-------|-----------|---------|
| Frontend | HTML5, CSS3, Bootstrap 5 | UI/UX |
| Frontend Logic | JavaScript (Vanilla) | Live search, AJAX |
| Backend | PHP 8.x (Native) | Routing, API, DB connection |
| Data Processing | Python 3.x | Chart generation |
| Visualization | Matplotlib | Pie chart rendering |
| Database | MySQL/MariaDB | Data storage |
| Database Logic | SQL (View, SP, Function, Trigger) | Business logic |

## Fitur Implementasi

✅ **CRUD Transaksi**
- Create: Form input dengan stored procedure
- Read: Tabel HTML dengan data dari database
- Update: Edit form dengan validasi
- Delete: Hapus dengan trigger audit

✅ **Live Search**
- JavaScript DOM manipulation
- Real-time filtering tanpa reload

✅ **Visualisasi**
- Python script untuk generate chart
- Auto-regenerate saat data berubah
- Pie chart pemasukan vs pengeluaran

✅ **Database Advanced Features**
- View untuk ringkasan
- Stored Procedure untuk insert
- Function untuk business logic
- Trigger untuk audit trail

## File Dependencies

### PHP Dependencies
- mysqli extension (built-in)
- shell_exec enabled (php.ini)

### Python Dependencies
- mysql-connector-python
- matplotlib
- pandas

### External (CDN)
- Bootstrap 5.3.0
- Bootstrap Icons 1.11.0

## Security Notes

⚠️ **Untuk Production:**
- Tambahkan input validation & sanitization
- Gunakan prepared statements (sudah implemented)
- Implementasi CSRF protection
- Add rate limiting untuk API
- Secure file upload (jika ada)
- Environment variables untuk config
- HTTPS enabled

## Testing Checklist

- [ ] Database connection works
- [ ] Can add transaction
- [ ] Can edit transaction
- [ ] Can delete transaction (check audit log)
- [ ] Chart generates correctly
- [ ] Live search works
- [ ] View returns correct data
- [ ] Stored procedure works
- [ ] Function returns correct status
- [ ] Trigger logs deleted data

